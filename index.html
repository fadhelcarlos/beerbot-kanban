<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>BeerBot — Project Board</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --bg: #0a0e17; --surface: #111827; --surface2: #1a2236; --surface3: #232d42;
  --border: #2a3550; --border-hover: #3d4f6f;
  --text: #e8ecf4; --text2: #94a3b8; --text3: #64748b;
  --amber: #f59e0b; --amber-dim: rgba(245,158,11,0.15);
  --green: #10b981; --green-dim: rgba(16,185,129,0.15);
  --blue: #3b82f6; --blue-dim: rgba(59,130,246,0.15);
  --purple: #8b5cf6; --purple-dim: rgba(139,92,246,0.15);
  --red: #ef4444; --red-dim: rgba(239,68,68,0.15);
  --cyan: #06b6d4; --cyan-dim: rgba(6,182,212,0.15);
  --px: 32px;
}
html { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); }
body { min-height: 100vh; overflow-x: hidden; }
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: .6; } }
@keyframes scaleIn { from { opacity: 0; transform: scale(.95); } to { opacity: 1; transform: scale(1); } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes msgOut { to { opacity: 0; height: 0; margin: 0; padding: 0; overflow: hidden; } }

/* Responsive board layout */
.kb-board { display: flex; gap: 24px; flex-wrap: wrap; align-items: flex-start; }
.kb-col { flex: 1 1 320px; min-width: 300px; max-width: 420px; }

@media (max-width: 768px) {
  :root { --px: 16px; }
  .kb-board { gap: 20px; }
  .kb-col { flex: 1 1 100%; max-width: 100%; min-width: 0; }
}
@media (max-width: 480px) {
  :root { --px: 12px; }
  .kb-board { gap: 16px; }
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useEffect, useCallback, useMemo } = React;

/* ─── Supabase ─── */
const SUPABASE_URL = 'https://oxwlinaowfhaitowcgzk.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94d2xpbmFvd2ZoYWl0b3djZ3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NzA4MzAsImV4cCI6MjA4NjQ0NjgzMH0.3F1-jTi_HGep1xA5-Lq-MQO0gq1aRzwXouZYEuGYAT8';
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ─── Route ─── */
const IS_ADMIN = window.location.hash.includes('admin') || window.location.pathname.includes('/admin');
const CURRENT_USER = IS_ADMIN ? 'carlos' : 'gadiel';

/* ─── Hooks ─── */
function useIsMobile(bp = 640) {
  const [m, setM] = useState(window.innerWidth < bp);
  useEffect(() => {
    const h = () => setM(window.innerWidth < bp);
    window.addEventListener('resize', h);
    return () => window.removeEventListener('resize', h);
  }, [bp]);
  return m;
}

/* ─── Icons (Lucide SVG) ─── */
const I = {
  board: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>,
  chat: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
  clip: <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>,
  send: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
  check: <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
  x: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
  quest: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
  beer: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 11h1a3 3 0 0 1 0 6h-1"/><path d="M9 12v6"/><path d="M13 12v6"/><path d="M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 3 11 3s2 .5 3 .5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.5-.5-2.5-.5Z"/><path d="M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"/></svg>,
  arrow: <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
  file: <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>,
  image: <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
  checkCircle: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
  zap: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
  listTodo: <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="5" width="6" height="6" rx="1"/><path d="m3 17 2 2 4-4"/><line x1="13" y1="6" x2="21" y2="6"/><line x1="13" y1="12" x2="21" y2="12"/><line x1="13" y1="18" x2="21" y2="18"/></svg>,
  shieldCheck: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>,
  user: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
  loader: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{animation:'spin 1s linear infinite'}}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
  circleCheck: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
  trash: <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
  download: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
  zoomIn: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>,
  zoomOut: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>,
  maximize: <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>,
  eye: <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
};

/* ─── Static Data ─── */
const QUESTIONS = [
  { id:'q1', question:'\u00bfYa tienes cuenta de Stripe creada para BeerBot?',
    subtitle:'Necesitamos 3 keys: publishable key, secret key, y webhook secret para activar pagos reales en el app.',
    options:[{label:'S\u00ed, tengo cuenta Stripe',value:'yes_stripe'},{label:'No, necesito crearla',value:'no_stripe'},{label:'Tengo cuenta pero no s\u00e9 d\u00f3nde est\u00e1n las keys',value:'need_help_stripe'}], allowCustom:true },
  { id:'q2', question:'\u00bfYa tienes cuenta de Veriff para verificaci\u00f3n de edad?',
    subtitle:'Necesitamos API key y API secret. Veriff maneja la foto de ID + selfie + liveness check.',
    options:[{label:'S\u00ed, tengo cuenta Veriff',value:'yes_veriff'},{label:'No, necesito crearla',value:'no_veriff'},{label:'Prefiero otro proveedor (Jumio, etc.)',value:'other_provider'}], allowCustom:true },
  { id:'q3', question:'\u00bfEn qu\u00e9 estado est\u00e1 el firmware del Arduino GIGA actualmente?',
    subtitle:'En tu conversaci\u00f3n con ChatGPT planificaste endpoints avanzados (startPour con tapId/targetOz/orderId, WebSocket para telemetr\u00eda). \u00bfYa est\u00e1n implementados o solo tiene /servir?count=N?',
    options:[{label:'Solo tiene /servir?count=N (b\u00e1sico)',value:'basic_firmware'},{label:'Ya tiene startPour/stopPour + telemetr\u00eda',value:'advanced_firmware'},{label:'Est\u00e1 en progreso, parcialmente implementado',value:'partial_firmware'}], allowCustom:true },
  { id:'q4', question:'\u00bfQu\u00e9 soluci\u00f3n prefieres para reemplazar NGROK en producci\u00f3n?',
    subtitle:'NGROK funciona para desarrollo pero no es ideal para un venue en vivo. Necesitamos una conexi\u00f3n estable entre la nube (Supabase) y tu red local (Pi + GIGA).',
    options:[{label:'Cloudflare Tunnel (gratis, estable)',value:'cloudflare'},{label:'VPN dedicado',value:'vpn'},{label:'Que el equipo decida lo mejor',value:'team_decides'}], allowCustom:true },
];

const COLUMNS = [
  { id:'todo', label:'Pending', icon:I.listTodo, accent:'var(--blue)' },
  { id:'progress', label:'In Progress', icon:I.zap, accent:'var(--amber)' },
  { id:'done', label:'Completed', icon:I.checkCircle, accent:'var(--green)' },
];

/* ─── Upload helper ─── */
async function uploadFile(file) {
  const ext = file.name.split('.').pop();
  const path = Date.now() + '_' + Math.random().toString(36).substr(2,9) + '.' + ext;
  const { error } = await sb.storage.from('kanban-files').upload(path, file, { contentType: file.type });
  if (error) throw error;
  const { data } = sb.storage.from('kanban-files').getPublicUrl(path);
  return { name: file.name, size: (file.size/1024).toFixed(1)+' KB', type: file.type.startsWith('image/') ? 'image' : 'file', mime: file.type, url: data.publicUrl };
}

/* ─── Supabase Hook ─── */
function useKanban() {
  const [tasks, setTasks] = useState([]);
  const [messages, setMessages] = useState({});
  const [answers, setAnswers] = useState({});
  const [loading, setLoading] = useState(true);
  const [connected, setConnected] = useState(false);

  useEffect(() => {
    let channel;
    async function init() {
      try {
        const [tR, mR, aR] = await Promise.all([
          sb.from('kanban_tasks').select('*').order('sort_order'),
          sb.from('kanban_messages').select('*').order('created_at'),
          sb.from('kanban_answers').select('*'),
        ]);
        if (tR.data) setTasks(tR.data);
        if (mR.data) { const g={}; mR.data.forEach(m=>{ if(!g[m.task_id])g[m.task_id]=[]; g[m.task_id].push(m); }); setMessages(g); }
        if (aR.data) { const a={}; aR.data.forEach(r=>{ a[r.question_id]=r.answer; }); setAnswers(a); }
      } catch(e) { console.error('Load error:', e); }
      setLoading(false);
    }
    init();

    channel = sb.channel('kanban-rt')
      .on('postgres_changes', {event:'*',schema:'public',table:'kanban_tasks'}, p => {
        if (p.eventType==='INSERT') setTasks(v=>{if(v.find(t=>t.id===p.new.id))return v;return[...v,p.new];});
        else if (p.eventType==='UPDATE') setTasks(v=>v.map(t=>t.id===p.new.id?p.new:t));
        else if (p.eventType==='DELETE') setTasks(v=>v.filter(t=>t.id!==p.old.id));
      })
      .on('postgres_changes', {event:'*',schema:'public',table:'kanban_messages'}, p => {
        if (p.eventType==='INSERT') {
          const m=p.new;
          setMessages(v=>{const ex=v[m.task_id]||[];if(ex.find(x=>x.id===m.id))return v;return{...v,[m.task_id]:[...ex,m]};});
        } else if (p.eventType==='DELETE') {
          const o=p.old;
          setMessages(v=>({...v,[o.task_id]:(v[o.task_id]||[]).filter(x=>x.id!==o.id)}));
        }
      })
      .on('postgres_changes', {event:'*',schema:'public',table:'kanban_answers'}, p => {
        if (p.eventType==='DELETE') setAnswers(v=>{const n={...v};delete n[p.old.question_id];return n;});
        else setAnswers(v=>({...v,[p.new.question_id]:p.new.answer}));
      })
      .subscribe(s => setConnected(s==='SUBSCRIBED'));

    return () => { if(channel) sb.removeChannel(channel); };
  }, []);

  const sendMessage = useCallback(async (taskId, text, attachments) => {
    const row = {task_id:taskId, sender:CURRENT_USER, text, attachments:attachments||[]};
    const {data,error} = await sb.from('kanban_messages').insert(row).select().single();
    if (!error&&data) setMessages(v=>{const ex=v[taskId]||[];if(ex.find(x=>x.id===data.id))return v;return{...v,[taskId]:[...ex,data]};});
  }, []);

  const deleteMessage = useCallback(async (msgId, taskId) => {
    setMessages(v=>({...v,[taskId]:(v[taskId]||[]).filter(x=>x.id!==msgId)}));
    await sb.from('kanban_messages').delete().eq('id', msgId);
  }, []);

  const answerQuestion = useCallback(async (qId, val) => {
    if (val===null) {
      await sb.from('kanban_answers').delete().eq('question_id', qId);
      setAnswers(v=>{const n={...v};delete n[qId];return n;});
    } else {
      const {data,error} = await sb.from('kanban_answers').upsert({question_id:qId,answer:val,answered_by:CURRENT_USER},{onConflict:'question_id'}).select().single();
      if (!error&&data) setAnswers(v=>({...v,[qId]:data.answer}));
    }
  }, []);

  return { tasks, messages, answers, loading, connected, sendMessage, deleteMessage, answerQuestion };
}

/* ─── Helpers ─── */
const fmtTime = d => d ? new Date(d).toLocaleTimeString('en',{hour:'2-digit',minute:'2-digit'}) : '';
const isViewable = mime => mime && (/^image\//.test(mime) || mime==='application/pdf');

/* ─── Components ─── */

function Badge({text,color}) {
  const c = {green:{bg:'var(--green-dim)',fg:'var(--green)'},amber:{bg:'var(--amber-dim)',fg:'var(--amber)'},blue:{bg:'var(--blue-dim)',fg:'var(--blue)'},purple:{bg:'var(--purple-dim)',fg:'var(--purple)'},red:{bg:'var(--red-dim)',fg:'var(--red)'},cyan:{bg:'var(--cyan-dim)',fg:'var(--cyan)'}}[color]||{bg:'var(--blue-dim)',fg:'var(--blue)'};
  return <span style={{display:'inline-block',padding:'2px 8px',borderRadius:6,fontSize:11,fontWeight:600,background:c.bg,color:c.fg,letterSpacing:'.02em'}}>{text}</span>;
}

function LoadingScreen() {
  return <div style={{minHeight:'100vh',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:16}}>
    <div style={{color:'var(--amber)'}}>{I.beer}</div><div style={{color:'var(--amber)'}}>{I.loader}</div>
    <p style={{fontSize:14,color:'var(--text2)'}}>Loading project board...</p>
  </div>;
}

function ConnectionDot({connected}) {
  return <div title={connected?'Realtime connected':'Connecting...'} style={{width:8,height:8,borderRadius:'50%',background:connected?'var(--green)':'var(--amber)',boxShadow:`0 0 6px ${connected?'var(--green)':'var(--amber)'}`,animation:connected?'none':'pulse 2s ease infinite',flexShrink:0}}/>;
}

/* ── File Viewer ── */
function FileViewer({file,onClose}) {
  const [zoom,setZoom] = useState(1);
  const isImg = file.mime && file.mime.startsWith('image/');
  const isPdf = file.mime === 'application/pdf';

  useEffect(() => {
    const h = e => { if(e.key==='Escape') { e.stopImmediatePropagation(); onClose(); } };
    window.addEventListener('keydown', h, true);
    return () => window.removeEventListener('keydown', h, true);
  }, [onClose]);

  return (
    <div style={{position:'fixed',inset:0,zIndex:2000,display:'flex',flexDirection:'column',background:'rgba(0,0,0,.92)',backdropFilter:'blur(12px)',animation:'fadeIn .2s ease'}} onClick={e=>{if(e.target===e.currentTarget) onClose();}}>
      {/* Top bar */}
      <div style={{display:'flex',alignItems:'center',gap:12,padding:'12px 20px',borderBottom:'1px solid rgba(255,255,255,.08)',flexShrink:0}}>
        <div style={{color:'var(--text2)',display:'flex'}}>{isImg ? I.image : I.file}</div>
        <span style={{fontSize:14,fontWeight:500,color:'var(--text)',flex:1,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{file.name}</span>
        <span style={{fontSize:12,color:'var(--text3)'}}>{file.size}</span>
        <a href={file.url} download={file.name} target="_blank" rel="noopener" style={{color:'var(--text2)',display:'flex',padding:6,borderRadius:6,background:'var(--surface3)',textDecoration:'none'}} title="Download">{I.download}</a>
        <button onClick={onClose} style={{color:'var(--text2)',display:'flex',padding:6,borderRadius:6,background:'var(--surface3)',border:'none',cursor:'pointer'}} title="Close">{I.x}</button>
      </div>

      {/* Content */}
      <div style={{flex:1,display:'flex',alignItems:'center',justifyContent:'center',overflow:'auto',padding:isImg?20:0}}>
        {isImg && <img src={file.url} alt={file.name} style={{maxWidth:'100%',maxHeight:'100%',objectFit:'contain',transform:`scale(${zoom})`,transition:'transform .2s ease',borderRadius:4}} />}
        {isPdf && <iframe src={file.url} title={file.name} style={{width:'100%',height:'100%',border:'none',borderRadius:0}} />}
        {!isImg && !isPdf && (
          <div style={{textAlign:'center',color:'var(--text2)'}}>
            <div style={{marginBottom:16}}>{I.file}</div>
            <p style={{fontSize:14}}>Preview not available for this file type.</p>
            <a href={file.url} download={file.name} target="_blank" rel="noopener" style={{display:'inline-flex',alignItems:'center',gap:6,marginTop:12,padding:'8px 16px',borderRadius:8,background:'var(--blue)',color:'#fff',textDecoration:'none',fontSize:13,fontWeight:500}}>{I.download} Download</a>
          </div>
        )}
      </div>

      {/* Bottom controls (images only) */}
      {isImg && (
        <div style={{display:'flex',justifyContent:'center',gap:8,padding:'12px 20px',borderTop:'1px solid rgba(255,255,255,.08)',flexShrink:0}}>
          {[{icon:I.zoomOut,fn:()=>setZoom(z=>Math.max(.25,z-.25))},{icon:I.maximize,fn:()=>setZoom(1)},{icon:I.zoomIn,fn:()=>setZoom(z=>Math.min(4,z+.25))}].map((b,i)=>(
            <button key={i} onClick={b.fn} style={{display:'flex',alignItems:'center',padding:'6px 12px',borderRadius:8,border:'1px solid var(--border)',background:'var(--surface3)',color:'var(--text2)',cursor:'pointer',gap:4,fontSize:12}}>{b.icon}</button>
          ))}
          <span style={{fontSize:12,color:'var(--text3)',display:'flex',alignItems:'center'}}>{Math.round(zoom*100)}%</span>
        </div>
      )}
    </div>
  );
}

/* ── Task Card ── */
function TaskCard({task,messageCount,onOpen,delay}) {
  const [hov,setHov] = useState(false);
  const tags = Array.isArray(task.tags) ? task.tags : [];
  return (
    <div onClick={()=>onOpen(task.id)} onMouseEnter={()=>setHov(true)} onMouseLeave={()=>setHov(false)}
      style={{background:hov?'var(--surface3)':'var(--surface2)',border:'1px solid '+(hov?'var(--border-hover)':'var(--border)'),borderRadius:12,padding:'14px 16px',cursor:'pointer',transition:'all .2s',transform:hov?'translateY(-1px)':'none',boxShadow:hov?'0 4px 20px rgba(0,0,0,.3)':'none',animation:`fadeIn .35s ease ${delay}ms both`}}>
      <div style={{display:'flex',gap:6,flexWrap:'wrap',marginBottom:8}}>{tags.map((t,i)=><Badge key={i} text={t} color={task.color}/>)}</div>
      <h4 style={{fontSize:14,fontWeight:600,color:'var(--text)',lineHeight:1.4,marginBottom:6}}>{task.title}</h4>
      <p style={{fontSize:12.5,color:'var(--text2)',lineHeight:1.5,display:'-webkit-box',WebkitLineClamp:2,WebkitBoxOrient:'vertical',overflow:'hidden'}}>{task.description}</p>
      {messageCount>0 && <div style={{display:'flex',alignItems:'center',gap:4,marginTop:10,color:'var(--text3)',fontSize:12}}>{I.chat} <span>{messageCount} message{messageCount!==1?'s':''}</span></div>}
    </div>
  );
}

function Column({col,tasks,messageCounts,onOpen}) {
  return (
    <div className="kb-col">
      <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:16,padding:'0 4px'}}>
        <span style={{color:col.accent,display:'flex'}}>{col.icon}</span>
        <h3 style={{fontSize:14,fontWeight:700,color:col.accent,textTransform:'uppercase',letterSpacing:'.06em'}}>{col.label}</h3>
        <span style={{fontSize:12,fontWeight:600,color:'var(--text3)',background:'var(--surface3)',borderRadius:10,padding:'2px 8px'}}>{tasks.length}</span>
      </div>
      <div style={{display:'flex',flexDirection:'column',gap:10}}>
        {tasks.map((t,i)=><TaskCard key={t.id} task={t} messageCount={messageCounts[t.id]||0} onOpen={onOpen} delay={i*50}/>)}
      </div>
    </div>
  );
}

/* ── Thread Message ── */
function ThreadMessage({msg,isLast,onDelete,onViewFile}) {
  const [hov,setHov] = useState(false);
  const isG = msg.sender==='gadiel';
  return (
    <div onMouseEnter={()=>setHov(true)} onMouseLeave={()=>setHov(false)}
      style={{display:'flex',flexDirection:'column',alignItems:isG?'flex-start':'flex-end',animation:'fadeIn .25s ease both',marginBottom:isLast?0:4}}>
      <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:4,flexDirection:isG?'row':'row-reverse'}}>
        <div style={{width:24,height:24,borderRadius:'50%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:11,fontWeight:700,color:'#fff',background:isG?'var(--green)':'var(--blue)'}}>{isG?'G':'C'}</div>
        <span style={{fontSize:11,color:'var(--text3)',fontWeight:500}}>{isG?'Gadiel':'Carlos'}</span>
        <span style={{fontSize:10,color:'var(--text3)'}}>{fmtTime(msg.created_at)}</span>
        {IS_ADMIN && hov && (
          <button onClick={e=>{e.stopPropagation();onDelete(msg.id,msg.task_id);}} title="Delete message"
            style={{display:'flex',padding:3,borderRadius:4,border:'none',background:'var(--red-dim)',color:'var(--red)',cursor:'pointer',opacity:.8,transition:'opacity .15s'}}>
            {I.trash}
          </button>
        )}
      </div>
      <div style={{background:isG?'var(--surface3)':'var(--blue-dim)',borderRadius:12,borderTopLeftRadius:isG?4:12,borderTopRightRadius:isG?12:4,padding:'10px 14px',maxWidth:'85%'}}>
        <p style={{fontSize:13,color:'var(--text)',lineHeight:1.5,whiteSpace:'pre-wrap'}}>{msg.text}</p>
        {msg.attachments && msg.attachments.length>0 && (
          <div style={{marginTop:8,display:'flex',flexDirection:'column',gap:4}}>
            {msg.attachments.map((a,i)=>(
              <div key={i} onClick={()=>a.url && onViewFile(a)}
                style={{display:'flex',alignItems:'center',gap:6,padding:'6px 10px',background:a.url?'rgba(0,0,0,.2)':'rgba(239,68,68,.08)',borderRadius:8,fontSize:12,color:a.url?'var(--text2)':'var(--text3)',cursor:a.url?'pointer':'default',transition:'background .15s',border:a.url?'none':'1px dashed rgba(239,68,68,.2)'}}
                onMouseEnter={e=>{if(a.url) e.currentTarget.style.background='rgba(59,130,246,.15)';}}
                onMouseLeave={e=>{e.currentTarget.style.background=a.url?'rgba(0,0,0,.2)':'rgba(239,68,68,.08)';}}>
                {a.type==='image'?I.image:I.file}
                <span style={{flex:1,textDecoration:a.url?'none':'line-through',opacity:a.url?1:.6}}>{a.name}</span>
                {a.url ? <span style={{color:'var(--blue)',display:'flex'}}>{I.eye}</span> : <span style={{fontSize:10,color:'var(--red)',fontWeight:500}}>Upload failed</span>}
                <span style={{fontSize:10,color:'var(--text3)'}}>{a.size}</span>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

/* ── Task Detail Modal ── */
function TaskDetail({task,taskMessages,onClose,onSendMessage,onDeleteMessage,onViewFile,mobile}) {
  const [msg,setMsg] = useState('');
  const [dragOver,setDragOver] = useState(false);
  const [uploading,setUploading] = useState(false);
  const scrollRef = useRef(null);
  const fileRef = useRef(null);

  useEffect(()=>{if(scrollRef.current) scrollRef.current.scrollTop=scrollRef.current.scrollHeight;},[taskMessages]);
  useEffect(()=>{const h=e=>{if(e.key==='Escape')onClose();};window.addEventListener('keydown',h);return()=>window.removeEventListener('keydown',h);},[onClose]);

  const handleSend = () => { if(!msg.trim()) return; onSendMessage(task.id,msg.trim()); setMsg(''); };
  const handleKey = e => { if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSend();} };

  const [uploadErr,setUploadErr] = useState('');
  const handleFiles = async (files) => {
    setUploading(true); setUploadErr('');
    for (const f of Array.from(files)) {
      try {
        const att = await uploadFile(f);
        onSendMessage(task.id, f.name, [att]);
      } catch(e) {
        console.error('Upload error:', e);
        setUploadErr('Upload failed: ' + (e.message||'Unknown error') + '. Try again.');
        setTimeout(()=>setUploadErr(''), 5000);
      }
    }
    setUploading(false);
  };

  const handleDrop = e => { e.preventDefault(); setDragOver(false); handleFiles(e.dataTransfer.files); };
  const colMeta = COLUMNS.find(c=>c.id===task.col);
  const tags = Array.isArray(task.tags)?task.tags:[];

  return (
    <div style={{position:'fixed',inset:0,zIndex:1000,display:'flex',alignItems:'center',justifyContent:'center',background:'rgba(0,0,0,.6)',backdropFilter:'blur(8px)',animation:'fadeIn .2s ease'}}
      onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
      <div style={{width:mobile?'100vw':'90vw',maxWidth:mobile?'100vw':640,height:mobile?'100vh':'auto',maxHeight:mobile?'100vh':'88vh',background:'var(--surface)',borderRadius:mobile?0:16,border:mobile?'none':'1px solid var(--border)',overflow:'hidden',display:'flex',flexDirection:'column',animation:'scaleIn .25s ease',boxShadow:'0 25px 60px rgba(0,0,0,.5)'}}>
        {/* Header */}
        <div style={{padding:mobile?'16px':'20px 24px 16px',borderBottom:'1px solid var(--border)'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:12}}>
            <div style={{flex:1}}>
              <div style={{display:'flex',gap:6,flexWrap:'wrap',marginBottom:8}}>
                {tags.map((t,i)=><Badge key={i} text={t} color={task.color}/>)}
                <Badge text={colMeta?colMeta.label:''} color={task.col==='done'?'green':task.col==='progress'?'amber':'blue'}/>
              </div>
              <h2 style={{fontSize:mobile?16:18,fontWeight:700,color:'var(--text)',lineHeight:1.3}}>{task.title}</h2>
            </div>
            <button onClick={onClose} style={{background:'var(--surface3)',border:'none',borderRadius:8,padding:6,cursor:'pointer',color:'var(--text3)',display:'flex'}}>{I.x}</button>
          </div>
          <p style={{fontSize:13.5,color:'var(--text2)',lineHeight:1.6}}>{task.description}</p>
        </div>

        {/* Messages */}
        <div ref={scrollRef} onDragOver={e=>{e.preventDefault();setDragOver(true);}} onDragLeave={()=>setDragOver(false)} onDrop={handleDrop}
          style={{flex:1,overflowY:'auto',padding:mobile?'12px 16px':'16px 24px',display:'flex',flexDirection:'column',gap:12,minHeight:120,background:dragOver?'rgba(59,130,246,.05)':'transparent',transition:'background .2s'}}>
          {(!taskMessages||taskMessages.length===0) ? (
            <div style={{display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',flex:1,gap:8,padding:'20px 0'}}>
              <div style={{color:'var(--text3)'}}>{I.chat}</div>
              <p style={{fontSize:13,color:'var(--text3)'}}>No messages yet. Type something or drag a file.</p>
            </div>
          ) : taskMessages.map((m,i)=><ThreadMessage key={m.id||i} msg={m} isLast={i===taskMessages.length-1} onDelete={onDeleteMessage} onViewFile={onViewFile}/>)}
        </div>

        {/* Upload error */}
        {uploadErr && <div style={{padding:'8px 24px',background:'var(--red-dim)',borderTop:'1px solid rgba(239,68,68,.2)',display:'flex',alignItems:'center',gap:8,animation:'fadeIn .2s ease'}}>
          <span style={{color:'var(--red)',fontSize:12,fontWeight:500,flex:1}}>{uploadErr}</span>
          <button onClick={()=>setUploadErr('')} style={{background:'none',border:'none',color:'var(--red)',cursor:'pointer',display:'flex',padding:2}}>{I.x}</button>
        </div>}

        {/* Input */}
        <div style={{padding:mobile?'10px 16px 14px':'12px 24px 16px',borderTop:'1px solid var(--border)',display:'flex',gap:8,alignItems:'flex-end'}}>
          <button onClick={()=>fileRef.current?.click()} disabled={uploading} style={{background:'var(--surface3)',border:'1px solid var(--border)',borderRadius:8,padding:'8px 10px',cursor:'pointer',color:'var(--text3)',display:'flex',flexShrink:0}}>
            {uploading ? I.loader : I.clip}
          </button>
          <input ref={fileRef} type="file" multiple accept="image/*,.pdf,.svg" style={{display:'none'}} onChange={e=>{handleFiles(e.target.files);e.target.value='';}}/>
          <textarea value={msg} onChange={e=>setMsg(e.target.value)} onKeyDown={handleKey} placeholder="Write a message..." rows={1}
            style={{flex:1,background:'var(--surface2)',border:'1px solid var(--border)',borderRadius:10,padding:'10px 14px',color:'var(--text)',fontSize:13.5,resize:'none',fontFamily:'Inter,sans-serif',outline:'none',minHeight:40,maxHeight:120}}
            onInput={e=>{e.target.style.height='auto';e.target.style.height=Math.min(e.target.scrollHeight,120)+'px';}}/>
          <button onClick={handleSend} disabled={!msg.trim()} style={{background:msg.trim()?'var(--blue)':'var(--surface3)',border:'none',borderRadius:10,padding:'9px 14px',cursor:msg.trim()?'pointer':'default',color:msg.trim()?'#fff':'var(--text3)',display:'flex',flexShrink:0,transition:'all .2s'}}>{I.send}</button>
        </div>
      </div>
    </div>
  );
}

/* ── Question Card ── */
function QuestionCard({q,answer,onAnswer,delay}) {
  const [custom,setCustom] = useState('');
  const [showC,setShowC] = useState(false);
  const isA = !!answer;
  const handleSel = v => { if(v==='__custom__'){setShowC(true);return;} onAnswer(q.id,v); };
  const submitC = () => { if(custom.trim()){onAnswer(q.id,custom.trim());setShowC(false);} };

  return (
    <div style={{background:'var(--surface2)',border:'1px solid '+(isA?'var(--green)':'var(--border)'),borderRadius:14,padding:'20px 24px',animation:`slideUp .4s ease ${delay}ms both`,transition:'border-color .3s'}}>
      <div style={{display:'flex',alignItems:'flex-start',gap:12,marginBottom:12}}>
        <div style={{width:32,height:32,borderRadius:10,display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0,background:isA?'var(--green-dim)':'var(--amber-dim)',color:isA?'var(--green)':'var(--amber)'}}>{isA?I.check:I.quest}</div>
        <div>
          <h3 style={{fontSize:15,fontWeight:600,color:'var(--text)',lineHeight:1.4}}>{q.question}</h3>
          <p style={{fontSize:12.5,color:'var(--text3)',marginTop:4,lineHeight:1.5}}>{q.subtitle}</p>
        </div>
      </div>
      {isA ? (
        <div style={{display:'flex',alignItems:'center',gap:8,padding:'10px 14px',background:'var(--green-dim)',borderRadius:10,marginTop:8,flexWrap:'wrap'}}>
          <span style={{color:'var(--green)',display:'flex'}}>{I.check}</span>
          <span style={{fontSize:13,color:'var(--green)',fontWeight:500,flex:1}}>{q.options.find(o=>o.value===answer)?.label||answer}</span>
          <button onClick={()=>onAnswer(q.id,null)} style={{background:'none',border:'none',color:'var(--text3)',fontSize:11,cursor:'pointer',textDecoration:'underline'}}>Change</button>
        </div>
      ) : (
        <div style={{display:'flex',flexDirection:'column',gap:6,marginTop:8}}>
          {q.options.map(opt=>(
            <button key={opt.value} onClick={()=>handleSel(opt.value)} style={{background:'var(--surface3)',border:'1px solid var(--border)',borderRadius:10,padding:'10px 14px',textAlign:'left',cursor:'pointer',color:'var(--text)',fontSize:13,fontWeight:500,transition:'all .15s',display:'flex',alignItems:'center',gap:8}}
              onMouseEnter={e=>{e.currentTarget.style.borderColor='var(--blue)';e.currentTarget.style.background='var(--blue-dim)';}} onMouseLeave={e=>{e.currentTarget.style.borderColor='var(--border)';e.currentTarget.style.background='var(--surface3)';}}>
              <span style={{width:16,height:16,borderRadius:'50%',border:'2px solid var(--border)',flexShrink:0}}/>{opt.label}
            </button>
          ))}
          {q.allowCustom && !showC && (
            <button onClick={()=>setShowC(true)} style={{background:'transparent',border:'1px dashed var(--border)',borderRadius:10,padding:'10px 14px',textAlign:'left',cursor:'pointer',color:'var(--text3)',fontSize:13,fontWeight:500}}
              onMouseEnter={e=>{e.currentTarget.style.borderColor='var(--border-hover)';}} onMouseLeave={e=>{e.currentTarget.style.borderColor='var(--border)';}}>Other answer...</button>
          )}
          {showC && (
            <div style={{display:'flex',gap:8,animation:'fadeIn .2s ease'}}>
              <input autoFocus value={custom} onChange={e=>setCustom(e.target.value)} onKeyDown={e=>{if(e.key==='Enter')submitC();}} placeholder="Type your answer..."
                style={{flex:1,background:'var(--surface3)',border:'1px solid var(--border)',borderRadius:10,padding:'10px 14px',color:'var(--text)',fontSize:13,fontFamily:'Inter,sans-serif',outline:'none'}}/>
              <button onClick={submitC} disabled={!custom.trim()} style={{background:custom.trim()?'var(--blue)':'var(--surface3)',border:'none',borderRadius:10,padding:'0 16px',cursor:custom.trim()?'pointer':'default',color:custom.trim()?'#fff':'var(--text3)',fontSize:13,fontWeight:600}}>OK</button>
            </div>
          )}
        </div>
      )}
    </div>
  );
}

/* ─── App ─── */
function App() {
  const { tasks,messages,answers,loading,connected,sendMessage,deleteMessage,answerQuestion } = useKanban();
  const [view,setView] = useState('board');
  const [openTask,setOpenTask] = useState(null);
  const [viewerFile,setViewerFile] = useState(null);
  const mobile = useIsMobile(768);

  const counts = useMemo(()=>({done:tasks.filter(t=>t.col==='done').length,progress:tasks.filter(t=>t.col==='progress').length,todo:tasks.filter(t=>t.col==='todo').length}),[tasks]);
  const msgCounts = useMemo(()=>{const mc={};Object.entries(messages).forEach(([k,v])=>{mc[k]=v.length;});return mc;},[messages]);
  const answeredN = Object.values(answers).filter(Boolean).length;
  const activeTask = openTask ? tasks.find(t=>t.id===openTask) : null;

  if (loading) return <LoadingScreen/>;

  return (
    <div style={{minHeight:'100vh',display:'flex',flexDirection:'column'}}>
      {/* Header */}
      <header style={{position:'sticky',top:0,zIndex:100,background:'rgba(10,14,23,.85)',backdropFilter:'blur(16px)',borderBottom:'1px solid var(--border)',padding:`0 var(--px)`}}>
        <div style={{maxWidth:1400,margin:'0 auto',display:'flex',alignItems:'center',flexWrap:'wrap',minHeight:mobile?'auto':64,gap:mobile?8:16,padding:mobile?'10px 0':'0'}}>
          <div style={{display:'flex',alignItems:'center',gap:10,color:'var(--amber)'}}>
            {I.beer}
            <span style={{fontWeight:800,fontSize:mobile?16:18,background:'linear-gradient(135deg,var(--amber),#fbbf24)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>BeerBot</span>
          </div>
          {!mobile && <span style={{color:'var(--text3)',fontSize:13}}>Project Board</span>}
          <ConnectionDot connected={connected}/>
          <div style={{display:'flex',alignItems:'center',gap:6,padding:'4px 10px 4px 8px',background:IS_ADMIN?'var(--blue-dim)':'var(--green-dim)',borderRadius:8}}>
            <span style={{color:IS_ADMIN?'var(--blue)':'var(--green)',display:'flex'}}>{IS_ADMIN?I.shieldCheck:I.user}</span>
            <span style={{fontSize:12,fontWeight:600,color:IS_ADMIN?'var(--blue)':'var(--green)'}}>{mobile ? (IS_ADMIN?'C':'G') : (IS_ADMIN?'Carlos':'Gadiel')}</span>
          </div>

          <div style={{marginLeft:mobile?0:'auto',display:'flex',gap:4,background:'var(--surface2)',borderRadius:10,padding:3,width:mobile?'100%':'auto',order:mobile?3:0}}>
            {[{key:'board',label:'Board',icon:I.board},{key:'questions',label:'Questions',icon:I.quest,badge:QUESTIONS.length-answeredN}].map(tab=>(
              <button key={tab.key} onClick={()=>setView(tab.key)} style={{display:'flex',alignItems:'center',justifyContent:'center',gap:6,padding:'7px 14px',borderRadius:8,border:'none',cursor:'pointer',fontSize:13,fontWeight:500,fontFamily:'Inter,sans-serif',flex:mobile?1:'none',background:view===tab.key?'var(--surface3)':'transparent',color:view===tab.key?'var(--text)':'var(--text3)',transition:'all .15s'}}>
                {tab.icon} {tab.label}
                {tab.badge>0 && <span style={{background:'var(--amber)',color:'#000',fontSize:10,fontWeight:700,borderRadius:10,padding:'1px 6px',minWidth:18,textAlign:'center',animation:'pulse 2s ease infinite'}}>{tab.badge}</span>}
              </button>
            ))}
          </div>
        </div>
      </header>

      {/* Stats */}
      <div style={{background:'var(--surface)',borderBottom:'1px solid var(--border)',padding:`${mobile?10:14}px var(--px)`}}>
        <div style={{maxWidth:1400,margin:'0 auto',display:'flex',gap:mobile?12:24,flexWrap:'wrap',alignItems:'center'}}>
          {[{l:'Completed',v:counts.done,t:tasks.length,c:'var(--green)'},{l:'In Progress',v:counts.progress,c:'var(--amber)'},{l:'Pending',v:counts.todo,c:'var(--blue)'}].map(s=>(
            <div key={s.l} style={{display:'flex',alignItems:'center',gap:8}}>
              <div style={{width:8,height:8,borderRadius:'50%',background:s.c}}/>
              {!mobile && <span style={{fontSize:13,color:'var(--text2)'}}>{s.l}:</span>}
              <span style={{fontSize:14,fontWeight:700,color:'var(--text)'}}>{s.v}{s.t?`/${s.t}`:''}</span>
            </div>
          ))}
          {!mobile && (
            <div style={{marginLeft:'auto',display:'flex',alignItems:'center',gap:6}}>
              <div style={{width:200,height:6,background:'var(--surface3)',borderRadius:3,overflow:'hidden'}}>
                <div style={{height:'100%',borderRadius:3,background:'linear-gradient(90deg,var(--green),var(--cyan))',width:tasks.length>0?`${(counts.done/tasks.length)*100}%`:'0%',transition:'width .5s ease'}}/>
              </div>
              <span style={{fontSize:12,fontWeight:600,color:'var(--green)'}}>{tasks.length>0?Math.round((counts.done/tasks.length)*100):0}%</span>
            </div>
          )}
        </div>
      </div>

      {/* Content */}
      <main style={{flex:1,padding:`${mobile?20:28}px var(--px)`,maxWidth:1400,margin:'0 auto',width:'100%'}}>
        {view==='board' ? (
          <div className="kb-board">
            {COLUMNS.map(col=><Column key={col.id} col={col} tasks={tasks.filter(t=>t.col===col.id)} messageCounts={msgCounts} onOpen={setOpenTask}/>)}
          </div>
        ) : (
          <div style={{maxWidth:640,margin:'0 auto'}}>
            <div style={{textAlign:'center',marginBottom:32,animation:'fadeIn .3s ease'}}>
              <h2 style={{fontSize:mobile?18:22,fontWeight:700,color:'var(--text)',marginBottom:8}}>Questions to unblock the project</h2>
              <p style={{fontSize:14,color:'var(--text2)',lineHeight:1.6}}>These {QUESTIONS.length} questions let us move forward with the only things we need from your side.<br/>Pick an option or type your own answer.</p>
              <div style={{display:'flex',justifyContent:'center',gap:6,marginTop:16}}>
                {QUESTIONS.map(q=><div key={q.id} style={{width:32,height:4,borderRadius:2,background:answers[q.id]?'var(--green)':'var(--surface3)',transition:'background .3s'}}/>)}
              </div>
              <p style={{fontSize:12,color:'var(--text3)',marginTop:8}}>{answeredN}/{QUESTIONS.length} answered</p>
            </div>
            <div style={{display:'flex',flexDirection:'column',gap:16}}>
              {QUESTIONS.map((q,i)=><QuestionCard key={q.id} q={q} answer={answers[q.id]} onAnswer={answerQuestion} delay={i*80}/>)}
            </div>
            {answeredN===QUESTIONS.length && (
              <div style={{marginTop:24,padding:'20px 24px',background:'var(--green-dim)',borderRadius:14,border:'1px solid var(--green)',textAlign:'center',animation:'slideUp .4s ease'}}>
                <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:8,marginBottom:6}}>
                  <span style={{color:'var(--green)',display:'flex'}}>{I.circleCheck}</span>
                  <p style={{fontSize:15,fontWeight:600,color:'var(--green)'}}>All questions answered! Thanks, Gadiel.</p>
                </div>
                <p style={{fontSize:13,color:'var(--text2)'}}>With this information we can move forward with the blocked items.</p>
              </div>
            )}
          </div>
        )}
      </main>

      {/* Modals */}
      {activeTask && <TaskDetail task={activeTask} taskMessages={messages[activeTask.id]||[]} onClose={()=>setOpenTask(null)} onSendMessage={sendMessage} onDeleteMessage={deleteMessage} onViewFile={setViewerFile} mobile={mobile}/>}
      {viewerFile && <FileViewer file={viewerFile} onClose={()=>setViewerFile(null)}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
